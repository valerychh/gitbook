# SSH

Использование SSH-ключей —простой и надёжный способ обеспечения безопасности соединения с сервером. В отличие от пароля, взломать SSH-ключ практически невозможно. Сгенерировать SSH-ключ очень просто.

Генерируем ключи:

```bash
ssh-keygen -t rsa
```

На консоль будет выведен следующий диалог:

```bash
Generating public/private rsa key pair.
Enter file in which to save the key (/home/ubuntu/.ssh/id_rsa):
```

Сначала программа попросит указать расположение файла для сохранения ключа, затем дважды ввести пароль для шифрования.

Нажмите на клавишу Enter. Далее система предложит ввести кодовую фразу для дополнительной защиты SSH-подключения:

```bash
Enter passphrase (empty for no passphrase):
```

Этот шаг можно пропустить. При ответе на этот и следующий вопрос просто нажмите клавишу Enter.

После этого ключ будет создан, а на консоль будет выведено следующее сообщение:

```bash
Your identification has been saved in /home/user/.ssh/id_rsa.
Your public key has been saved in /home/user/.ssh/id_rsa.pub.
The key fingerprint is:
476:b2:a8:7f:08:b4:c0:af:81:25:7e:21:48:01:0e:98 user@localhost

The key's randomart image is:

+--[ RSA 2048]----+

|+.o.             |

|ooE              |

|oo               |

|o.+..            |

|.+.+..  S .      |

|....+  o +       |

|  .o ....        |

|  .  .. .        |

|    ....         |

+-----------------+
```

Посмотреть ключ:

```bash
cat ~/.ssh/id_rsa.pub
```

Ключ с расширением **.pub** - это ваш публичный ключ, который необходимо скопировать на сервер, к которому мы хотим подключаться без пароля. Ключ без расширения - это приватный ключ, который должен храниться у вас.

Копируем публичный ключ на сервер:

> Для того чтобы скопировать публичный ключ по ssh - необходима учётная запись, которой разрешено подключаться на сервер по ssh. Как это сделать будет написано в конце статьи.

```bash
ssh-copy-id -i root@server
```

Вводим пароль и при необходимости подтверждаем доверие к серверу.

### Альтернативные способы копирования ключа

Существуют альтернативные способы копирования ключа на удалённый сервер. Если по какой-то причине, не получилось скопировать ключ с помощью утилиты **ssh-copy-id**, можно это сделать следующим образом:

```bash
cat ~/.ssh/id_rsa.pub | ssh root@ip-адрес-сервера 'cat >> ~/.ssh/authorized_keys'
```

Или зайти на сервер, перейти в каталог ~/.ssh/, создать здесь документ **id\_rsa.pub** и вставить содержимое вашего публичного ключа.

### Отключение доступа к серверу по паролю

После того, как мы скопировали публичный ключ на удалённый сервер, нам необходимо отключить доступ к серверу по паролю. Редактируем конфигурационный файл ssh:

```bash
vim /etc/ssh/sshd_config
```

**PasswordAuthentication** **no** - вход по паролю отключен.  
**AllowUsers** **valerych** - разрешает подключение пользователю **valerych**.  
**AllowGroups** **root** - разрешает подключение всем, кто состоит в группе **root**.  
**DenyUsers** **user** - запрещает подключение пользователю **user**.  
**DenyGroups** **Users** - запрещает подключение всем, кто состоит в группе **Users**.  
**PermitRootLogin** **no** - запрещает подключение пользователю **root**.

После всех манипуляций с файлом конфигурации, необходимо перезапустить сервис ssh:

```bash
systemctl restart sshd
```

