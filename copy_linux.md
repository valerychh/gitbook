# Копирование файлов в Linux

#### УТИЛИТА КОПИРОВАНИЯ ФАЙЛОВ CP

СИНТАКСИС И ОПЦИИ

**$ cp опции файл-источник файл-приемник**

Или:

**$ cp опции файл-источник директория-приемник/**

* **--attributes-only** - не копировать содержимое файла, а только флаги доступа и владельца;
* **-f, --force** - перезаписывать существующие файлы;
* **-i, --interactive** - спрашивать, нужно ли перезаписывать существующие файлы;
* **-L** - копировать не символические ссылки, а то, на что они указывают;
* **-n** - не перезаписывать существующие файлы;
* **-P** - не следовать символическим ссылкам;
* **-r** - копировать папку Linux рекурсивно;
* **-s** - не выполнять копирование файлов в Linux, а создавать символические ссылки;
* **-u** - скопировать файл, только если он был изменён;
* **-x** - не выходить за пределы этой файловой системы;
* **-p** - сохранять владельца, временные метки и флаги доступа при копировании;
* **-t** - считать файл-приемник директорией и копировать файл-источник в эту директорию.

#### ПРИМЕРЫ КОПИРОВАНИЯ ФАЙЛОВ В LINUX

Теперь, когда вы знаете основные опции, можно перейти к практике. Например, мы хотим скопировать некую картинку из домашней папки в подкаталог pictures:

 `cp ~/pic.png ~/pictures/`

Или можем явно указать имя новой картинки:

 `cp ~/pic.png ~/pictures/wallpaper.png`

Копирование папок осуществляется с помощью ключа **-r**:

 `cp  -R ~/папка ~/Документы/`

По умолчанию команда **cp** Linux перезаписывает существующие файлы или папки, но можно заставить утилиту спрашивать, нужно ли перезаписывать каждый файл, если вы не уверены в правильности составления команды:

 `cp -i ~/test ~/Documents/test`

Есть и противоположная опция **-n**, означающая "никогда не перезаписывать существующие файлы".

Опция **-u** полезна в следующем случае: вы знаете или предполагаете, что в директории, куда копируется файл, есть старая его версия, тогда оператор -u выполнит замену на новую версию:

 `cp -u ~/test ~/Documents/test`

**Сp** также поддерживает специальные символы замены **\*** и **?**. Например, следующая команда скопирует все файлы, начинающиеся на **test**:

 `cp ~/test* ~/Документы/`

Если нужно применить более сложные регулярные выражения, придётся комбинировать утилиту **cp** с **find** или **egrep**.

В случае, если важно сохранить права доступа к файлу и его владельца, нужно использовать опцию **-p**:

 `cp -p ~/test* ~/Документы/`

Для упрощения использования команды можно применять синтаксис фигурных скобок. Например, чтобы создать резервную копию файла, выполните:

`$ cp test.conf{,.bak}`

Будет создан файл с таким же именем и расширением .bak

По умолчанию в **cp** не отображается [прогресс копирования файла](https://losst.ru/kak-posmotret-progress-komandy-v-linux), что очень неудобно при работе с большими файлами, но его можно легко посмотреть с помощью утилиты **cv**.

### КОПИРОВАНИЕ ФАЙЛОВ ПО РЕГУЛЯРНЫМ ВЫРАЖЕНИЯМ В LINUX

В утилите **find** можно применять различные условия и регулярные выражения для поиска файлов. Мы можем скопировать все найденные с помощью **find** файлы, вызвав для каждого из них команду **cp**. Например, копируем все файлы в текущей директории, содержащие в имени только цифры:

 `find . -name [0-9] -exec cp {} ~/Документы \`

Здесь точка указывает на текущую директорию, а параметр **name** задает регулярное выражение. Параметром **exec** мы задаем, какую команду нужно выполнить для обнаруженных файлов. Символ **{}** - подставляет имя каждого файла.

Но не **find**'ом единым такое делается. То же самое можно получить, запросив список файлов директории в **ls**, отфильтровав его по регулярному выражению **egrep** и передав имена файлов по очереди в **cp** с помощью **xargs**:

 `ls -1 ~/ | egrep '[a-zA-Z]' | xargs cp -t ~/Папка/`

Это не совсем удобный способ копировать файлы Linux, но всё же он возможен. Будут скопированы все файлы из домашней директории, содержащие в имени только английские буквы.

### КОПИРОВАНИЕ СОДЕРЖИМОГО ФАЙЛОВ В LINUX

Вы можете не только копировать сами файлы, но и управлять их содержимым. Например, склеить несколько файлов в один или разрезать файл на несколько частей. Утилита **cat** используется для вывода содержимого файла, в комбинации с операторами перенаправления вывода Bash вы можете выполнять копирование содержимого файла Linux в другой файл. Например:

 `cat файл1 > файл2`

Если файл был не пустым, он будет перезаписан. Или мы можем склеить два отдельных файла в один:

 `cat файл1 файл2 > файл3`

### СПЕЦИАЛЬНОЕ КОПИРОВАНИЕ ФАЙЛОВ В LINUX С ПОМОЩЬЮ TAR

Копирование в Linux тоже может быть выполнено не только с помощью **cp**. При переносе системных файлов в другой каталог, резервном копировании системных файлов и т.д. важно чтобы сохранились атрибуты, значения владельцев файлов и символические ссылки как они есть без какой-либо модификации.

Утилита **cp** тоже может справиться с такой задачей, если указать опцию **-p**, но можно использовать утилиту архивации **tar**. Мы не будем создавать никаких файлов архивов, а построим туннель. Первая часть команды пакует файл и отправляет на стандартный вывод, а другая сразу же распаковывает в нужную папку:

 `tar cf - /var | ( cd /mnt/var && tar xvf - )`

Здесь мы полностью копируем содержимое папки /var в папку /mnt/var. Так вы можете копировать папку Linux, причём абсолютно любую или даже целую операционную систему.

